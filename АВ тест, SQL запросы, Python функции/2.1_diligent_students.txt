--Образовательные курсы состоят из различных уроков, каждый из которых состоит из нескольких маленьких заданий. 
--Каждое такое маленькое задание называется "горошиной".
--Назовём очень усердным учеником того пользователя, который хотя бы раз за текущий месяц правильно решил 20 горошин.
--Необходимо написать оптимальный запрос, который даст информацию о количестве очень усердных студентов.
--NB! Под усердным студентом мы понимаем студента, который правильно решил 20 задач за текущий месяц.

--проверяю за какое время данные
SELECT 
    min( timest ),
    max( timest )
FROM default.peas

--result :
--2021-10-30 13:00:00
--2021-10-31 17:29:52

--Данные за 30-31 числа 10 месяца 2021 года


SELECT
    COUNT(DISTINCT st_id) as number_diligent_students   --считаю кол-во уникальных id
FROM
    (
    SELECT 
        st_id,
        COUNT(correct) as count_les, --считаю кол-во решённых горошин
        subject
    FROM default.peas
        WHERE correct = 1 --отбираю только правильно решённые
        GROUP BY st_id  --группирую по студентам (при уточнении запроса у заказчика, возможно добавил бы по предмету) 
    HAVING count_les > 19 --отбираю значения 20 и более решённых горошин у каждого студента по предметам
    )
    
--result : 136